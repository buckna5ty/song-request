<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DCE • Song Requests</title>
  <link rel="preconnect" href="https://form.jotform.com">
  <style>
    body { margin:0; background:#f3f4ff; font-family: Inter, "Helvetica Neue", Arial, sans-serif; color:#111; }
    .wrap { max-width: 920px; margin: 0 auto; padding: 16px; }
    .logo { text-align:center; margin: 12px 0 20px; }
    .logo img { max-width: 220px; height: auto; }
    .card { background:#fff; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); padding:16px; }
    h2 { margin:0 0 12px; text-align:center; font-weight:700; }
    #selected { max-width:920px; margin:8px auto 16px; font-size:14px; color:#333; text-align:center; min-height:18px; }
    iframe { width:100%; border:0; display:block; }
    .spacer { height:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo">
      <img src="assets/client-logo.png" alt="Client Logo" onerror="this.style.display='none'">
    </div>

    <div class="card">
      <h2>Search for a Song</h2>
      <!-- NOTE the ?title=0 to hide the widget’s own heading -->
      <iframe id="searchFrame" src="./index.html?title=0" title="Song Search" loading="lazy" style="height:520px"></iframe>
    </div>

    <div id="selected"></div>

    <div class="spacer"></div>

    <!-- Jotform embed (we'll prefill via URL when a track is chosen) -->
    <div class="card">
      <iframe id="jotFrame"
        title="Song Request Form"
        loading="lazy"
        style="height:1400px"
        src="https://form.jotform.com/252746100648052">
      </iframe>
    </div>
  </div>

  <script>
    const JOT_ID = '252746100648052';
    const JOT_BASE = `https://form.jotform.com/${JOT_ID}`;

    function setSelected(title, artist){
      const el = document.getElementById('selected');
      if (!title && !artist) { el.textContent=''; return; }
      el.innerHTML = `Selected: <strong>${title || 'Unknown Title'} — ${artist || 'Unknown Artist'}</strong>`;
    }

    // Listen for picks from the widget and prefill Jotform via URL params
    window.addEventListener('message', (e) => {
      const msg = e.data;
      if (!msg || msg.action !== 'setFields' || !msg.fields) return;

      const title  = msg.fields.song_title || '';
      const artist = msg.fields.artist || '';
      const link   = msg.fields.link || '';

      setSelected(title, artist);

      const params = new URLSearchParams({
        q12_song_title: title,
        q8_artist: artist,
        q9_link: link
      });
      document.getElementById('jotFrame').src = `${JOT_BASE}?${params.toString()}`;
    });
  </script>
</body>
</html>
