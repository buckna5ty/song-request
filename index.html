<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en" class="supernova ">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1" />
  <title>Song Request â€¢ David Charles Events</title>

  <!-- Jotform CSS (official) -->
  <link rel="stylesheet" href="https://cdn.jotfor.ms/stylebuilder/static/form-common.css"/>
  <link id="custom-font" rel="stylesheet" href="//cdn.jotfor.ms/fonts/?family=Inter" />
  <link rel="stylesheet" href="https://cdn.jotfor.ms/themes/CSS/5e6b428acc8c4e222d1beb91.css"/>
  <link rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_styles.css" />
  <link rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_feature.css" />

  <!-- Jotform JS (official) -->
  <script>window.enableEventObserver=true</script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/prototype.forms.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/jotform.forms.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/vendor/smoothscroll.min.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/errorNavigation.js"></script>

  <style>
    /* Match Jotform page look; only tiny tweaks */
    body { background:#f3f2ff; margin:0; }
    .dce-logo { text-align:center; margin: 18px 0 8px; }
    .dce-logo img { max-width:220px; height:auto; }
    /* Hide the real submission fields to guests */
    #id_12, #id_8, #id_9 { display:none !important; }
    /* Make the widget container height fluid but nice on mobile */
    #searchWidget { width:100%; border:0; height:420px; }
    @media (max-width:520px){ #searchWidget{ height:460px; } }
    .form-subLabel { color:#6b7280; font-size:12px; }
  </style>

  <script>
    JotForm.newDefaultTheme = true;
    JotForm.singleProduct = false;
    JotForm.init(function(){});
    /* Map the hidden field IDs from your Jotform export */
    const FIELD_IDS = { song_title: 'input_12', artist: 'input_8', link: 'input_9' };
  </script>
</head>
<body>
  <div role="main" class="form-all" style="max-width: 960px; margin: 0 auto;">
    <div class="dce-logo">
      <img src="assets/client-logo.png" alt="David Charles Events" onerror="this.style.display='none'">
    </div>

    <ul class="form-section page-section" role="presentation">
      <!-- Your Name (visible; matches Jotform style) -->
      <li class="form-line jf-required" data-type="control_textbox" id="id_7">
        <label class="form-label form-label-top form-label-auto" id="label_7" for="input_7">
          Your Name<span class="form-required">*</span>
        </label>
        <div id="cid_7" class="form-input-wide jf-required" data-layout="half">
          <input type="text" id="input_7" name="q7_yourName" class="form-textbox validate[required]" style="width:310px" data-component="textbox" required />
        </div>
      </li>

      <!-- Jotform-styled "Song or Artist" field that *is* your live widget -->
      <li class="form-line" data-type="control_widget" id="id_widget">
        <label class="form-label form-label-top form-label-auto" id="label_widget" for="searchWidget">Song or Artist</label>
        <div id="cid_widget" class="form-input-wide" data-layout="half">
          <iframe id="searchWidget" src="widget.html" title="Song Search"></iframe>
          <div class="form-subLabel" style="margin-top:6px;">Tip: Tap a result to use it. The form will fill instantly.</div>
        </div>
      </li>

      <!-- Optional read-only displays so the guest sees their pick inside the form -->
      <li class="form-line" data-type="control_textbox" id="id_disp_title">
        <label class="form-label form-label-top form-label-auto" for="input_disp_title">Selected Song</label>
        <div class="form-input-wide" data-layout="half">
          <input type="text" id="input_disp_title" class="form-textbox" style="width:310px;background:#f7f7f7;border-color:#e5e7eb" readonly aria-readonly="true" placeholder="(choose above)" />
        </div>
      </li>
      <li class="form-line" data-type="control_textbox" id="id_disp_artist">
        <label class="form-label form-label-top form-label-auto" for="input_disp_artist">Artist</label>
        <div class="form-input-wide" data-layout="half">
          <input type="text" id="input_disp_artist" class="form-textbox" style="width:310px;background:#f7f7f7;border-color:#e5e7eb" readonly aria-readonly="true" placeholder="(choose above)" />
        </div>
      </li>

      <!-- Hidden submission fields (actually go to Google Sheets) -->
      <li class="form-line" id="id_12" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_12">song_title</label>
        <div id="cid_12" class="form-input-wide" data-layout="half">
          <input type="text" id="input_12" name="song_title" class="form-textbox" style="width:310px" />
        </div>
      </li>
      <li class="form-line" id="id_8" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_8">artist</label>
        <div id="cid_8" class="form-input-wide" data-layout="half">
          <input type="text" id="input_8" name="artist" class="form-textbox" style="width:310px" />
        </div>
      </li>
      <li class="form-line" id="id_9" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_9">link</label>
        <div id="cid_9" class="form-input-wide" data-layout="half">
          <input type="text" id="input_9" name="link" class="form-textbox" style="width:310px" />
        </div>
      </li>

      <!-- Submit button (identical style) -->
      <li class="form-line" data-type="control_button" id="id_2">
        <div id="cid_2" class="form-input-wide" data-layout="full">
          <div data-align="auto" class="form-buttons-wrapper form-buttons-auto">
            <button id="input_2" type="submit" class="form-submit-button submit-button jf-form-buttons">Submit</button>
          </div>
        </div>
      </li>
    </ul>

    <!-- The real Jotform form wrapper to keep their submission pipeline intact -->
    <form class="jotform-form"
          action="https://submit.jotform.com/submit/252746100648052"
          method="post"
          name="form_252746100648052"
          id="252746100648052"
          accept-charset="utf-8"
          autocomplete="on"
          style="display:none;"></form>
  </div>

  <!-- Minimal tokens Jotform expects (kept invisible) -->
  <input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="252746100648052" />
  <script>
    // keep Jotform happy about SPC (safe to leave as-is)
    var all_spc = document.querySelectorAll("#" + "simple_spc");
    for (var i = 0; i < all_spc.length; i++) { all_spc[i].value = "252746100648052-252746100648052"; }
  </script>

  <!-- Instant-fill listener (no reload) -->
  <script>
    const FIELD_NAMES = { song_title: 'song_title', artist: 'artist', link: 'link' };

    function setHiddenField(key, value) {
      // 1) by ID (exported IDs)
      const byId = document.getElementById(FIELD_IDS[key]);
      if (byId) { byId.value = value || ''; byId.dispatchEvent(new Event('change', {bubbles:true})); return true; }
      // 2) by name (fallback)
      let byName = document.querySelector(`[name="${FIELD_NAMES[key]}"]`);
      if (byName) { byName.value = value || ''; byName.dispatchEvent(new Event('change', {bubbles:true})); return true; }
      return false;
    }
    function setDisplayFields(title, artist) {
      const t = document.getElementById('input_disp_title');
      const a = document.getElementById('input_disp_artist');
      if (t) t.value = title || '';
      if (a) a.value = artist || '';
    }
    window.addEventListener('message', (e) => {
      // If you want to restrict to same-origin only, uncomment:
      // if (e.origin !== window.location.origin) return;
      const msg = e.data;
      if (!msg || msg.action !== 'setFields' || !msg.fields) return;
      const { song_title, artist, link } = msg.fields;
      if (song_title !== undefined) setHiddenField('song_title', song_title);
      if (artist     !== undefined) setHiddenField('artist',     artist);
      if (link       !== undefined) setHiddenField('link',       link);
      setDisplayFields(song_title, artist);
    });

    // Submit handler: build and submit a real Jotform POST using a temporary form
    document.getElementById('input_2').addEventListener('click', function(ev){
      ev.preventDefault();
      const tmp = document.createElement('form');
      tmp.action = 'https://submit.jotform.com/submit/252746100648052';
      tmp.method = 'POST';
      tmp.style.display = 'none';

      function add(name, value){
        const i=document.createElement('input');
        i.name=name; i.value=value||''; tmp.appendChild(i);
      }
      add('formID','252746100648052');
      add('q7_yourName', document.getElementById('input_7').value || '');
      add('song_title',  document.getElementById('input_12').value || '');
      add('artist',      document.getElementById('input_8').value || '');
      add('link',        document.getElementById('input_9').value || '');
      // SPC token
      add('simple_spc','252746100648052-252746100648052');

      document.body.appendChild(tmp);
      tmp.submit();
    });
  </script>
</body>
</html>
