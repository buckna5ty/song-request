<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en" class="supernova ">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1" />
  <title>Song Request • David Charles Events</title>

  <!-- Jotform CSS (official) -->
  <link type="text/css" rel="stylesheet" href="https://cdn.jotfor.ms/stylebuilder/static/form-common.css"/>
  <link id="custom-font" type="text/css" rel="stylesheet" href="//cdn.jotfor.ms/fonts/?family=Inter" />
  <link type="text/css" rel="stylesheet" href="https://cdn.jotfor.ms/themes/CSS/5e6b428acc8c4e222d1beb91.css"/>
  <link type="text/css" rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_styles.css" />
  <link type="text/css" rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_feature.css" />

  <!-- Jotform JS (official) -->
  <script>window.enableEventObserver=true</script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/prototype.forms.js" type="text/javascript"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/jotform.forms.js" type="text/javascript"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/vendor/smoothscroll.min.js" type="text/javascript"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/errorNavigation.js" type="text/javascript"></script>

  <!-- Page polish -->
  <style>
    body { background:#fff; color:#111; font-family: Inter, Arial, sans-serif; margin:0; }
    .wrap { max-width: 920px; margin: 0 auto; padding: 16px; }
    .logo { text-align:center; margin: 12px 0 16px; }
    .logo img { max-width: 220px; height:auto; }
    .box { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:14px; }
    .section-title { font-weight:800; margin: 0 0 10px; text-align:center; }
    .widget-note { font-size:12px; color:#777; margin:6px 0 0 0; text-align:left; }
    /* Hide hidden JF fields to guests */
    #id_12, #id_8, #id_9 { display:none !important; }
    #selectedStatus { margin:8px 0 12px; font-size:14px; color:#333; text-align:left; }
  </style>

  <script type="text/javascript">
    JotForm.newDefaultTheme = true;
    JotForm.singleProduct = false;
    JotForm.init(function(){});
    // Map of fields — make sure IDs match your export (we also fall back by name)
    const FIELD_IDS = { song_title: 'input_12', artist: 'input_8', link: 'input_9' };
  </script>
</head>
<body>
  <div class="wrap">
    <div class="logo">
      <img src="assets/client-logo.png" alt="Client Logo" onerror="this.style.display='none'">
    </div>

    <!-- (A) LIVE SEARCH WIDGET (inside the page, above the form) -->
    <div class="box" style="margin-bottom:12px">
      <h2 class="section-title">Find Your Song</h2>
      <iframe
        id="searchWidget"
        src="widget.html"
        title="Song Search"
        loading="lazy"
        style="width:100%;max-width:100%;border:0;height:420px"
      ></iframe>
      <div id="selectedStatus"></div>
      <div class="widget-note">Tip: Tap a result to select it. The fields below will be filled instantly.</div>
    </div>

    <!-- (B) THE JOTFORM FORM (exported) -->
    <div class="box">
      <form class="jotform-form"
            action="https://submit.jotform.com/submit/252746100648052"
            method="post"
            name="form_252746100648052"
            id="252746100648052"
            accept-charset="utf-8"
            autocomplete="on">
        <input type="hidden" name="formID" value="252746100648052" />

        <div role="main" class="form-all">
          <ul class="form-section page-section" role="presentation">
            <!-- Guest Name (visible) -->
            <li class="form-line jf-required" data-type="control_textbox" id="id_7">
              <label class="form-label form-label-top form-label-auto" id="label_7" for="input_7">
                Your Name<span class="form-required">*</span>
              </label>
              <div id="cid_7" class="form-input-wide jf-required" data-layout="half">
                <input type="text" id="input_7" name="q7_yourName" class="form-textbox validate[required]" style="width:310px" data-component="textbox" required />
              </div>
            </li>

            <!-- Hidden: song_title -->
            <li class="form-line" data-type="control_textbox" id="id_12" style="display:none">
              <label class="form-label form-label-top form-label-auto" id="label_12" for="input_12">song_title</label>
              <div id="cid_12" class="form-input-wide" data-layout="half">
                <input type="text" id="input_12" name="song_title" class="form-textbox" style="width:310px" />
              </div>
            </li>

            <!-- Hidden: artist -->
            <li class="form-line" data-type="control_textbox" id="id_8" style="display:none">
              <label class="form-label form-label-top form-label-auto" id="label_8" for="input_8">artist</label>
              <div id="cid_8" class="form-input-wide" data-layout="half">
                <input type="text" id="input_8" name="artist" class="form-textbox" style="width:310px" />
              </div>
            </li>

            <!-- Hidden: link -->
            <li class="form-line" data-type="control_textbox" id="id_9" style="display:none">
              <label class="form-label form-label-top form-label-auto" id="label_9" for="input_9">link</label>
              <div id="cid_9" class="form-input-wide" data-layout="half">
                <input type="text" id="input_9" name="link" class="form-textbox" style="width:310px" />
              </div>
            </li>

            <!-- Submit -->
            <li class="form-line" data-type="control_button" id="id_2">
              <div id="cid_2" class="form-input-wide" data-layout="full">
                <div data-align="auto" class="form-buttons-wrapper form-buttons-auto">
                  <button id="input_2" type="submit" class="form-submit-button submit-button jf-form-buttons">Submit</button>
                </div>
              </div>
            </li>
            <li style="display:none">Should be Empty: <input type="text" name="website" value="" /></li>
          </ul>
        </div>

        <!-- Required by Jotform -->
        <input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="252746100648052" />
        <script type="text/javascript">
          var all_spc = document.querySelectorAll("form[id='252746100648052'] .si" + "mple" + "_spc");
          for (var i = 0; i < all_spc.length; i++) { all_spc[i].value = "252746100648052-252746100648052"; }
        </script>
      </form>
    </div>
  </div>

  <!-- ===== Instant-fill listener: receives {action:'setFields', fields:{...}} from widget.html ===== -->
  <script>
    const FIELD_NAMES = { song_title: 'song_title', artist: 'artist', link: 'link' };

    function setField(key, value) {
      // 1) by ID (from your export)
      const byId = document.getElementById(FIELD_IDS[key]);
      if (byId) {
        byId.value = value || '';
        byId.dispatchEvent(new Event('input', { bubbles: true }));
        byId.dispatchEvent(new Event('change', { bubbles: true }));
        return true;
      }
      // 2) by exact name (e.g. name="song_title")
      let byName = document.querySelector(`[name="${FIELD_NAMES[key]}"]`);
      if (byName) {
        byName.value = value || '';
        byName.dispatchEvent(new Event('input', { bubbles: true }));
        byName.dispatchEvent(new Event('change', { bubbles: true }));
        return true;
      }
      // 3) best-effort: name endsWith
      byName = Array.from(document.querySelectorAll('input[type="text"], input[type="hidden"]'))
        .find(n => n.name && n.name.endsWith(FIELD_NAMES[key]));
      if (byName) {
        byName.value = value || '';
        byName.dispatchEvent(new Event('input', { bubbles: true }));
        byName.dispatchEvent(new Event('change', { bubbles: true }));
        return true;
      }
      console.warn('Field not found for', key);
      return false;
    }

    function showSelected(title, artist) {
      const el = document.getElementById('selectedStatus');
      if (!el) return;
      if (!title && !artist) { el.textContent = ''; return; }
      el.innerHTML = 'Selected: <strong>' + (title || 'Unknown Title') + ' — ' + (artist || 'Unknown Artist') + '</strong>';
    }

    window.addEventListener('message', (e) => {
      // Optional: restrict to same-origin widget
      // if (e.origin !== window.location.origin) return;
      const msg = e.data;
      if (!msg || msg.action !== 'setFields' || !msg.fields) return;

      const { song_title, artist, link } = msg.fields;

      if (song_title !== undefined) setField('song_title', song_title);
      if (artist     !== undefined) setField('artist',     artist);
      if (link       !== undefined) setField('link',       link);

      showSelected(song_title, artist);
    });
  </script>
</body>
</html>
