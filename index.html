<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en" class="supernova ">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1" />
  <title>Song Request â€¢ David Charles Events</title>

  <!-- Jotform CSS -->
  <link rel="stylesheet" href="https://cdn.jotfor.ms/stylebuilder/static/form-common.css"/>
  <link id="custom-font" rel="stylesheet" href="//cdn.jotfor.ms/fonts/?family=Inter" />
  <link rel="stylesheet" href="https://cdn.jotfor.ms/themes/CSS/5e6b428acc8c4e222d1beb91.css"/>
  <link rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_styles.css" />
  <link rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_feature.css" />

  <!-- Jotform JS -->
  <script>window.enableEventObserver=true</script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/prototype.forms.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/jotform.forms.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/vendor/smoothscroll.min.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/errorNavigation.js"></script>

  <style>
    :root{
      --field-w: 640px;
      --teal: #0ea5a6;
      --ring: rgba(14,165,166,.25);
      --border: #e5e7eb;
      --radius: 8px;
      --bg: #fff;
      --ink: #111;
    }

    /* Custom heading & button font (already in repo root) */
    @font-face{
      font-family: "TexGyreAdventorBold";
      src: url("texgyreadventor-bold.otf") format("opentype");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    body { background:#f3f2ff; margin:0; color:var(--ink); }
    .dce-logo { text-align:center; margin: 18px 0 4px; }
    .dce-logo img { max-width:220px; height:auto; }

    .app-title{
      text-align:center;
      margin: 0 auto 10px;
      font-family: "TexGyreAdventorBold", Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      letter-spacing: .06em;
      line-height: 1.05;
      font-size: clamp(20px, 6.2vw, 36px);
      max-width: 66vw;
      color:#111;
    }

    /* Hide submission fields from guests */
    #id_12, #id_8, #id_9 { display:none; }

    /* Normalize visible inputs (Name + Selected display) */
    .form-textbox{
      width: var(--field-w);
      max-width: 100%;
      height: 48px;
      padding: 0 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg);
      box-sizing: border-box;
      font-size: 16px;
      line-height: 1.25;
      outline: none;
      appearance: none;
      -webkit-appearance: none;
      box-shadow: none;
    }

    /* Your Name: no hover highlight; teal ring on focus */
    #input_7:hover{ border-color: var(--border) !important; box-shadow:none !important; }
    #input_7:focus{ border-color: var(--teal) !important; box-shadow: 0 0 0 4px var(--ring) !important; outline:none; }

    .selected-ring{
      border-color: var(--teal) !important;
      box-shadow: 0 0 0 4px var(--ring) !important;
      transition: box-shadow .2s ease, border-color .2s ease;
    }

    /* Widget iframe */
    #searchWidget { width:100%; border:0; height:320px; transition:height .2s ease; }

    /* Tight spacing */
    #id_widget { margin-bottom: 0; }
    #id_disp_selected { margin-top: 4px; display:none; }
    #id_2 { margin-top: 8px; }

    /* Submit button: black, white, all caps */
    #input_2.form-submit-button{
      background:#111 !important;
      color:#fff !important;
      text-transform: uppercase !important;
      font-family:"TexGyreAdventorBold", Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif !important;
      letter-spacing:.04em;
      border-radius: 10px;
      border: 1px solid #111 !important;
      padding: 14px 28px;
      height:auto;
    }
    #input_2.form-submit-button:hover{ filter:brightness(0.92); }
    #input_2.form-submit-button:active{ transform: translateY(1px); }

    /* Full-screen Thank You overlay (matches your screenshot) */
    .ty-overlay{
      position:fixed; inset:0; background:#fff; display:none;
      align-items:center; justify-content:center; z-index:9999;
    }
    .ty-wrap{ text-align:center; padding:24px; max-width: 92vw; }
    .ty-icon{
      width:96px; height:96px; margin:0 auto 22px;
      display:grid; place-items:center;
      border-radius:50%; background:#22c55e; /* green */
      box-shadow: 0 6px 18px rgba(34,197,94,.35);
      animation: pop .24s ease-out;
    }
    .ty-icon svg{ width:52px; height:52px; color:#fff; }
    @keyframes pop{ from{ transform:scale(.9); opacity:.4 } to{ transform:scale(1); opacity:1 } }

    .ty-title{
      font-family:"TexGyreAdventorBold", Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-size: clamp(28px, 7.8vw, 56px);
      line-height: 1.05;
      margin: 0 0 10px;
      color:#0f172a; /* slate-900 */
    }
    .ty-sub{
      font: 500 16px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:#64748b; /* slate-500 */
      margin:0;
    }
  </style>

  <script>
    /* ====== CONFIG ====== */
    const REDIRECT_URL     = "https://www.davidcharlesevents.com/song-request"; // where to go after TY
    const REDIRECT_DELAY_MS= 4000;                                              // 4 seconds

    JotForm.newDefaultTheme = true;
    JotForm.singleProduct = false;
    JotForm.init(function(){});

    const MAP = {
      yourName:   { id: 'input_7',  q: 7,  uname: 'q7_yourName' },
      song_title: { id: 'input_12', q: 12, uname: 'song_title' },
      artist:     { id: 'input_8',  q: 8,  uname: 'artist' },
      link:       { id: 'input_9',  q: 9,  uname: 'link' }
    };

    function setHiddenField(key, value) {
      const el = document.getElementById(MAP[key]?.id);
      if (!el) return false;
      el.value = value || '';
      el.dispatchEvent(new Event('input', { bubbles:true }));
      el.dispatchEvent(new Event('change', { bubbles:true }));
      return true;
    }

    function showSelectedField(text) {
      const li    = document.getElementById('id_disp_selected');
      const input = document.getElementById('input_disp_selected');
      if (!li || !input) return;
      if (text && text.trim()) {
        input.value = text;
        li.style.display = 'block';
        li.setAttribute('aria-hidden','false');
        input.classList.add('selected-ring');
      } else {
        input.value = '';
        li.style.display = 'none';
        li.setAttribute('aria-hidden','true');
        input.classList.remove('selected-ring');
      }
    }

    function buildHiddenInput(name, val){
      const i=document.createElement('input');
      i.type='hidden'; i.name=name; i.value=val||'';
      return i;
    }

    function openThankYou(){
      const ov = document.getElementById('tyOverlay');
      if (ov) ov.style.display = 'flex';
    }
    function redirectAfterDelay(){
      setTimeout(()=>{ window.location.href = REDIRECT_URL; }, REDIRECT_DELAY_MS);
    }

    function submitToJotform(ev){
      ev.preventDefault();

      const nameVal  = (document.getElementById(MAP.yourName.id)?.value   || '');
      const titleVal = (document.getElementById(MAP.song_title.id)?.value || '');
      const artistVal= (document.getElementById(MAP.artist.id)?.value     || '');
      const linkVal  = (document.getElementById(MAP.link.id)?.value       || '');

      // Hidden iframe target to avoid cross-site navigation
      let targetFrame = document.getElementById('jf_target');
      if (!targetFrame) {
        targetFrame = document.createElement('iframe');
        targetFrame.name = 'jf_target';
        targetFrame.id = 'jf_target';
        targetFrame.style.display = 'none';
        document.body.appendChild(targetFrame);
      }

      // When Jotform responds (load event), show TY and schedule redirect
      targetFrame.onload = function(){
        openThankYou();
        redirectAfterDelay();
      };

      const tmp = document.createElement('form');
      tmp.action = 'https://submit.jotform.com/submit/252746100648052';
      tmp.method = 'POST';
      tmp.target = 'jf_target';
      tmp.style.display = 'none';

      tmp.appendChild( buildHiddenInput('formID','252746100648052') );
      tmp.appendChild( buildHiddenInput('simple_spc','252746100648052-252746100648052') );

      // Send both unique names and q# names for reliability
      tmp.appendChild( buildHiddenInput(MAP.yourName.uname, nameVal) );
      tmp.appendChild( buildHiddenInput(`q${MAP.yourName.q}_yourName`, nameVal) );

      tmp.appendChild( buildHiddenInput(MAP.song_title.uname, titleVal) );
      tmp.appendChild( buildHiddenInput(`q${MAP.song_title.q}_song_title`, titleVal) );

      tmp.appendChild( buildHiddenInput(MAP.artist.uname, artistVal) );
      tmp.appendChild( buildHiddenInput(`q${MAP.artist.q}_artist`, artistVal) );

      tmp.appendChild( buildHiddenInput(MAP.link.uname, linkVal) );
      tmp.appendChild( buildHiddenInput(`q${MAP.link.q}_link`, linkVal) );

      document.body.appendChild(tmp);
      tmp.submit();

      // Also open TY immediately for snappier UX; redirect timer as fallback
      openThankYou();
      redirectAfterDelay();
    }

    /* Messages from widget */
    window.addEventListener('message', (e) => {
      const msg = e.data;
      if (!msg || !msg.action) return;

      if (msg.action === 'setFields' && msg.fields) {
        const { song_title, artist, link } = msg.fields;
        if (song_title !== undefined) setHiddenField('song_title', song_title);
        if (artist     !== undefined) setHiddenField('artist',     artist);
        if (link       !== undefined) setHiddenField('link',       link);
        const label = [song_title, artist].filter(Boolean).join(' - ');
        showSelectedField(label);
      }

      if (msg.action === 'resize' && typeof msg.height === 'number') {
        const iframe = document.getElementById('searchWidget');
        if (iframe) {
          const minH = 88, maxH = 640;
          iframe.style.height = Math.max(minH, Math.min(msg.height, maxH)) + 'px';
        }
      }

      if (msg.action === 'ready') {
        document.getElementById('input_7')?.focus({preventScroll:true});
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('input_7')?.focus({preventScroll:true});
      document.getElementById('input_2')?.addEventListener('click', submitToJotform);
    });
  </script>
</head>
<body>
  <div role="main" class="form-all" style="max-width: 960px; margin: 0 auto;">
    <div class="dce-logo">
      <img src="assets/client-logo.png" alt="David Charles Events" onerror="this.style.display='none'">
    </div>
    <div class="app-title">SONG REQUEST APP</div>

    <ul class="form-section page-section" role="presentation">
      <!-- Your Name -->
      <li class="form-line jf-required" data-type="control_textbox" id="id_7">
        <label class="form-label form-label-top form-label-auto" id="label_7" for="input_7">
          Your Name<span class="form-required">*</span>
        </label>
        <div id="cid_7" class="form-input-wide jf-required" data-layout="half">
          <input type="text" id="input_7" name="q7_yourName" class="form-textbox validate[required]" required />
        </div>
      </li>

      <!-- Live search (widget) -->
      <li class="form-line" data-type="control_widget" id="id_widget">
        <label class="form-label form-label-top form-label-auto" id="label_widget" for="searchWidget">Song or Artist</label>
        <div id="cid_widget" class="form-input-wide" data-layout="half" style="max-width:var(--field-w);">
          <iframe id="searchWidget" src="widget.html" title="Song Search"></iframe>
        </div>
      </li>

      <!-- Read-only "Selected Song - Artist" -->
      <li class="form-line" data-type="control_textbox" id="id_disp_selected">
        <label class="form-label form-label-top form-label-auto" for="input_disp_selected">Selected Song - Artist</label>
        <div class="form-input-wide" data-layout="half">
          <input type="text" id="input_disp_selected" class="form-textbox" readonly aria-readonly="true" />
        </div>
      </li>

      <!-- Hidden submission fields -->
      <li class="form-line" id="id_12" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_12">song_title</label>
        <div id="cid_12" class="form-input-wide" data-layout="half">
          <input type="text" id="input_12" name="song_title" class="form-textbox" />
        </div>
      </li>
      <li class="form-line" id="id_8" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_8">artist</label>
        <div id="cid_8" class="form-input-wide" data-layout="half">
          <input type="text" id="input_8" name="artist" class="form-textbox" />
        </div>
      </li>
      <li class="form-line" id="id_9" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_9">link</label>
        <div id="cid_9" class="form-input-wide" data-layout="half">
          <input type="text" id="input_9" name="link" class="form-textbox" />
        </div>
      </li>

      <!-- Submit -->
      <li class="form-line" data-type="control_button" id="id_2">
        <div id="cid_2" class="form-input-wide" data-layout="full">
          <div data-align="auto" class="form-buttons-wrapper form-buttons-auto">
            <button id="input_2" type="submit" class="form-submit-button submit-button jf-form-buttons">Submit</button>
          </div>
        </div>
      </li>
    </ul>
  </div>

  <!-- Full-screen Thank You overlay -->
  <div class="ty-overlay" id="tyOverlay" role="dialog" aria-live="polite" aria-modal="true">
    <div class="ty-wrap">
      <div class="ty-icon" aria-hidden="true">
        <!-- checkmark -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 6L9 17l-5-5"></path>
        </svg>
      </div>
      <h1 class="ty-title">Got it!</h1>
      <p class="ty-sub">If it fits the flow, weâ€™ll get it on. Letâ€™s party.</p>
    </div>
  </div>

  <!-- SPC token Jotform expects -->
  <input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="252746100648052" />
  <script>
    var all_spc = document.querySelectorAll("#simple_spc");
    for (var i = 0; i < all_spc.length; i++) { all_spc[i].value = "252746100648052-252746100648052"; }
  </script>
</body>
</html>
