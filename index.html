<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en" class="supernova ">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=1" />
  <title>Song Request â€¢ David Charles Events</title>

  <!-- Jotform CSS -->
  <link rel="stylesheet" href="https://cdn.jotfor.ms/stylebuilder/static/form-common.css"/>
  <link id="custom-font" rel="stylesheet" href="//cdn.jotfor.ms/fonts/?family=Inter" />
  <link rel="stylesheet" href="https://cdn.jotfor.ms/themes/CSS/5e6b428acc8c4e222d1beb91.css"/>
  <link rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_styles.css" />
  <link rel="stylesheet" href="https://cdn.jotfor.ms/css/styles/payment/payment_feature.css" />

  <!-- Jotform JS -->
  <script>window.enableEventObserver=true</script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/prototype.forms.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/static/jotform.forms.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/vendor/smoothscroll.min.js"></script>
  <script src="https://cdn.jotfor.ms/s/static/70873410d56/js/errorNavigation.js"></script>

  <style>
    body { background:#f3f2ff; margin:0; }
    .dce-logo { text-align:center; margin: 18px 0 8px; }
    .dce-logo img { max-width:220px; height:auto; }

    /* Hide submission fields from guests */
    #id_12, #id_8, #id_9 { display:none; }

    /* Widget iframe auto-resizes */
    #searchWidget { width:100%; border:0; height:420px; transition:height .2s ease; }

    /* Selected row is hidden until a pick */
    #id_disp_selected { display:none; }
  </style>

  <script>
    JotForm.newDefaultTheme = true;
    JotForm.singleProduct = false;
    JotForm.init(function(){});

    /* Field map (IDs + unique names) */
    const MAP = {
      yourName:   { id: 'input_7',  q: 7,  uname: 'q7_yourName' },
      song_title: { id: 'input_12', q: 12, uname: 'song_title' },
      artist:     { id: 'input_8',  q: 8,  uname: 'artist' },
      link:       { id: 'input_9',  q: 9,  uname: 'link' }
    };

    function setHiddenField(key, value) {
      const el = document.getElementById(MAP[key]?.id);
      if (!el) return false;
      el.value = value || '';
      el.dispatchEvent(new Event('input', { bubbles:true }));
      el.dispatchEvent(new Event('change', { bubbles:true }));
      return true;
    }

    // ðŸ‘‰ Force the Selected row visible and update its value
    function showSelectedField(text) {
      const li    = document.getElementById('id_disp_selected');
      const input = document.getElementById('input_disp_selected');
      if (!li || !input) return;
      if (text && text.trim()) {
        input.value = text;
        li.style.display = 'block';            // force visible (li default in JF theme)
        li.setAttribute('aria-hidden','false');
      } else {
        input.value = '';
        li.style.display = 'none';
        li.setAttribute('aria-hidden','true');
      }
    }

    // Submit to Jotform (send both unique names & qIDs)
    function submitToJotform(ev){
      ev.preventDefault();

      const nameVal  = (document.getElementById(MAP.yourName.id)?.value   || '');
      const titleVal = (document.getElementById(MAP.song_title.id)?.value || '');
      const artistVal= (document.getElementById(MAP.artist.id)?.value     || '');
      const linkVal  = (document.getElementById(MAP.link.id)?.value       || '');

      const tmp = document.createElement('form');
      tmp.action = 'https://submit.jotform.com/submit/252746100648052';
      tmp.method = 'POST';
      tmp.style.display = 'none';

      const add = (name,val)=>{ const i=document.createElement('input'); i.type='hidden'; i.name=name; i.value=val||''; tmp.appendChild(i); };

      add('formID','252746100648052');
      add('simple_spc','252746100648052-252746100648052');

      add(MAP.yourName.uname, nameVal);
      add(`q${MAP.yourName.q}_yourName`, nameVal);

      add(MAP.song_title.uname, titleVal);
      add(`q${MAP.song_title.q}_song_title`, titleVal);

      add(MAP.artist.uname, artistVal);
      add(`q${MAP.artist.q}_artist`, artistVal);

      add(MAP.link.uname, linkVal);
      add(`q${MAP.link.q}_link`, linkVal);

      document.body.appendChild(tmp);
      tmp.submit();
    }

    // Messages from widget
    window.addEventListener('message', (e) => {
      const msg = e.data;
      if (!msg || !msg.action) return;

      if (msg.action === 'setFields' && msg.fields) {
        const { song_title, artist, link } = msg.fields;

        if (song_title !== undefined) setHiddenField('song_title', song_title);
        if (artist     !== undefined) setHiddenField('artist',     artist);
        if (link       !== undefined) setHiddenField('link',       link);

        const label = [song_title, artist].filter(Boolean).join(' â€” ');
        showSelectedField(label);                 // ensure it appears
      }

      if (msg.action === 'resize' && typeof msg.height === 'number') {
        const iframe = document.getElementById('searchWidget');
        if (iframe) {
          const minH = 240, maxH = 640;
          iframe.style.height = Math.max(minH, Math.min(msg.height, maxH)) + 'px';
        }
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('input_2')?.addEventListener('click', submitToJotform);
    });
  </script>
</head>
<body>
  <div role="main" class="form-all" style="max-width: 960px; margin: 0 auto;">
    <div class="dce-logo">
      <img src="assets/client-logo.png" alt="David Charles Events" onerror="this.style.display='none'">
    </div>

    <ul class="form-section page-section" role="presentation">
      <!-- Your Name -->
      <li class="form-line jf-required" data-type="control_textbox" id="id_7">
        <label class="form-label form-label-top form-label-auto" id="label_7" for="input_7">
          Your Name<span class="form-required">*</span>
        </label>
        <div id="cid_7" class="form-input-wide jf-required" data-layout="half">
          <input type="text" id="input_7" name="q7_yourName" class="form-textbox validate[required]" style="width:310px" required />
        </div>
      </li>

      <!-- Live search (widget) -->
      <li class="form-line" data-type="control_widget" id="id_widget">
        <label class="form-label form-label-top form-label-auto" id="label_widget" for="searchWidget">Song or Artist</label>
        <div id="cid_widget" class="form-input-wide" data-layout="half">
          <iframe id="searchWidget" src="widget.html" title="Song Search"></iframe>
        </div>
      </li>

      <!-- Read-only "Song â€” Artist" (hidden until a pick) -->
      <li class="form-line" data-type="control_textbox" id="id_disp_selected">
        <label class="form-label form-label-top form-label-auto" for="input_disp_selected">Selected</label>
        <div class="form-input-wide" data-layout="half">
          <input type="text" id="input_disp_selected" class="form-textbox"
                 style="width:310px;background:#f7f7f7;border-color:#e5e7eb" readonly aria-readonly="true" />
        </div>
      </li>

      <!-- Hidden submission fields -->
      <li class="form-line" id="id_12" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_12">song_title</label>
        <div id="cid_12" class="form-input-wide" data-layout="half">
          <input type="text" id="input_12" name="song_title" class="form-textbox" style="width:310px" />
        </div>
      </li>
      <li class="form-line" id="id_8" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_8">artist</label>
        <div id="cid_8" class="form-input-wide" data-layout="half">
          <input type="text" id="input_8" name="artist" class="form-textbox" style="width:310px" />
        </div>
      </li>
      <li class="form-line" id="id_9" style="display:none">
        <label class="form-label form-label-top form-label-auto" for="input_9">link</label>
        <div id="cid_9" class="form-input-wide" data-layout="half">
          <input type="text" id="input_9" name="link" class="form-textbox" style="width:310px" />
        </div>
      </li>

      <!-- Submit -->
      <li class="form-line" data-type="control_button" id="id_2">
        <div id="cid_2" class="form-input-wide" data-layout="full">
          <div data-align="auto" class="form-buttons-wrapper form-buttons-auto">
            <button id="input_2" type="submit" class="form-submit-button submit-button jf-form-buttons">Submit</button>
          </div>
        </div>
      </li>
    </ul>
  </div>

  <!-- SPC token Jotform expects -->
  <input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="252746100648052" />
  <script>
    var all_spc = document.querySelectorAll("#simple_spc");
    for (var i = 0; i < all_spc.length; i++) { all_spc[i].value = "252746100648052-252746100648052"; }
  </script>
</body>
</html>
